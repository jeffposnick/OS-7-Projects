/* #includes */#include "misc.h"/* #defines */#define kMax			2500#define kBaseID			128#define kWindW			618#define kWindH			436#define kMoveToFront	(WindowPtr)-1L#define kAppleMenuItems	'DRVR'#define kSleep			LONG_MAX#define kMaxColor		65536/* Prototypes */void main(void);void HandleMenuChoice(long menuChoice);void SetUpInterface(void);void EventLoop(void);void ChangeForeColor(void);void ClearScreen(void);void Randomize(unsigned int *x1, unsigned int *x2, unsigned int *y1, unsigned int *y2);/* Globals */Boolean		gDone=FALSE;WindowPtr	gWindow;/* Does some intializations and enters the event loop */void main(void){	ToolboxInit();		srand(clock());		SetUpInterface();		EventLoop();}/* Creates the window and menu bar */void SetUpInterface(void){	/* Local Variables */	Handle 		menuBar;	MenuHandle 	menuHnd;		menuBar=GetNewMBar(kBaseID);	SetMenuBar(menuBar);	menuHnd=GetMHandle(kBaseID);	AppendResMenu(menuHnd, kAppleMenuItems);	DrawMenuBar();		gWindow=GetNewWindow(kBaseID, 0L, kMoveToFront);	ShowWindow(gWindow);	SetPort(gWindow);}/* Waits for events and dispatches them to the appropriate function */void EventLoop(void){	/* Local Variables */	WindowPtr 	tmpWindow;	EventRecord event;	char 		theChar;	short 		thePart;		while(gDone==FALSE)	{		WaitNextEvent(everyEvent, &event, kSleep, 0L);				switch(event.what)		{			case keyDown:			case autoKey:				theChar = (event.message & charCodeMask);				if ((event.modifiers & cmdKey) != 0) 					HandleMenuChoice(MenuKey(theChar));				break;			case updateEvt:				BeginUpdate(gWindow);				EndUpdate(gWindow);			break;			case mouseDown:				thePart=FindWindow(event.where,&tmpWindow);				switch(thePart)				{					case inMenuBar:						HandleMenuChoice(MenuSelect(event.where));						break;					case inSysWindow:						SystemClick(&event, tmpWindow);						break;					case inDrag:						DragWindow(tmpWindow, event.where, &qd.screenBits.bounds);						break;					case inGoAway:						gDone=TRUE;						break;				}				break;		}				}}/* Handles user interaction in menus */void HandleMenuChoice(long menuChoice){	/* Local Variables */	Rect 			rect;	MenuHandle 		appleMenu;	Str255 			accName;	unsigned int 	x1, x2, y1, y2, temp, color=1;	short 			menu, menuItem;	long 			i;		if(menuChoice>0)	{		menu=HiWord(menuChoice);		menuItem=LoWord(menuChoice);				switch(menu)		{			case 128:				switch(menuItem)				{					case 1:						Alert(128, 0L);						break;					default:						appleMenu = GetMHandle(128);						GetItem(appleMenu, menuItem, accName );						OpenDeskAcc(accName);						break;				}				break;			case 129:				switch(menuItem)				{					case 1:					case 2:						for(i=1;i<kMax;i++)						{							ChangeForeColor();														Randomize(&x1, &x2, &y1, &y2);														if(x2<x1)							{								temp=x2;								x2=x1;								x1=temp;							}							if(y2<y1)							{								temp=y2;								y2=y1;								y1=temp;							}														rect.left=y1;							rect.top=x1;							rect.right=y2;							rect.bottom=x2;														if(menuItem==1)								PaintRect(&rect);							else								PaintOval(&rect);						}						SysBeep(1);						break;					case 3:						for(i=1;i<kMax*10;i++)						{							ChangeForeColor();														Randomize(&x1, &x2, &y1, &y2);														MoveTo(y1,x1);							LineTo(y2,x2);						}						SysBeep(1);						break;					case 5:						ClearScreen();						SysBeep(1);						break;					case 7:						SysBeep(1);						break;					case 9:						gDone=TRUE;						break;				}		}		HiliteMenu(0);	}}/* Clears the currunt window by filling it with a white rectangle */void ClearScreen(void){	FillRect(&((*gWindow).portRect), &qd.white);}/* Gives four variables a random value */void Randomize(unsigned int *x1, unsigned int *x2, unsigned int *y1, unsigned int *y2){	/* Local Variables */	Rect	windowRect;	float	temp;		windowRect=(*gWindow).portRect;		temp=RANDOM((windowRect.bottom)+2);	*x1=((int)temp)-1;	temp=RANDOM((windowRect.bottom)+2);	*x2=((int)temp)-1;	temp=RANDOM((windowRect.right)+2);	*y1=((int)temp)-1;	temp=RANDOM((windowRect.right)+2);	*y2=((int)temp)-1;}/* Changes the fore-color based on the value of the parameter */void ChangeForeColor(void){	RGBColor hue;    hue.red=RANDOM(kMaxColor);    hue.green=RANDOM(kMaxColor);    hue.blue=RANDOM(kMaxColor);    RGBForeColor(&hue);}